import{V as g,L as O,D}from"./deckgl_core-B-Jwjxqj.js";import{r as E}from"./react-Bzgz95E1.js";var o=E();const M=typeof window<"u"?o.useLayoutEffect:o.useEffect;function R(e,n){for(;e;){if(e===n)return!0;e=Object.getPrototypeOf(e)}return!1}const U={position:"absolute",zIndex:-1};function b(e,n){if(typeof e=="function")return e(n);if(Array.isArray(e))return e.map(r=>b(r,n));if(m(e)){if(A(e))return n.style=U,o.cloneElement(e,n);if(_(e))return o.cloneElement(e,n)}return e}function m(e){return e&&typeof e=="object"&&"type"in e||!1}function A(e){return e.props?.mapStyle}function _(e){const n=e.type;return n&&n.deckGLViewProps}function x(e){if(typeof e=="function")return o.createElement(g,{},e);if(Array.isArray(e))return e.map(x);if(m(e)){if(e.type===o.Fragment)return x(e.props.children);if(R(e.type,g))return e}return e}function q({children:e,layers:n=[],views:r=null}){const c=[],s=[],t={};return o.Children.forEach(x(e),i=>{if(m(i)){const a=i.type;if(R(a,O)){const d=P(a,i.props);s.push(d)}else c.push(i);if(R(a,g)&&a!==g&&i.props.id){const d=new a(i.props);t[d.id]=d}}else i&&c.push(i)}),Object.keys(t).length>0&&(Array.isArray(r)?r.forEach(i=>{t[i.id]=i}):r&&(t[r.id]=r),r=Object.values(t)),n=s.length>0?[...s,...n]:n,{layers:n,children:c,views:r}}function P(e,n){const r={},c=e.defaultProps||{};for(const s in n)c[s]!==n[s]&&(r[s]=n[s]);return new e(r)}const z=o.createContext();function G({children:e,deck:n,ContextProvider:r=z.Provider}){const{viewManager:c}=n||{};if(!c||!c.views.length)return[];const s={},t=c.views[0].id;for(const i of e){let a=t,d=i;m(i)&&R(i.type,g)&&(a=i.props.id||t,d=i.props.children);const f=c.getViewport(a),l=c.getViewState(a);if(f){l.padding=f.padding;const{x:p,y:k,width:w,height:y}=f;d=b(d,{x:p,y:k,width:w,height:y,viewport:f,viewState:l}),s[a]||(s[a]={viewport:f,children:[]}),s[a].children.push(d)}}return Object.keys(s).map(i=>{const{viewport:a,children:d}=s[i],{x:f,y:l,width:p,height:k}=a,w={position:"absolute",left:f,top:l,width:p,height:k},y=`view-${i}`,h=o.createElement("div",{key:y,id:y,style:w},...d),S={deck:n,viewport:a,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:v=>{v.viewId=i,n._onViewStateChange(v)},widgets:[]},V=`view-${i}-context`;return o.createElement(r,{key:V,value:S},h)})}const Y={mixBlendMode:null};function $({width:e,height:n,style:r}){const c={position:"absolute",zIndex:0,left:0,top:0,width:e,height:n},s={left:0,top:0};if(r)for(const t in r)t in Y?s[t]=r[t]:c[t]=r[t];return{containerStyle:c,canvasStyle:s}}function F(e){return{get deck(){return e.deck},pickObject:n=>e.deck.pickObject(n),pickMultipleObjects:n=>e.deck.pickMultipleObjects(n),pickObjects:n=>e.deck.pickObjects(n)}}function j(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function H(e,n,r){const c=new n({...r,_customRender:r.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{e.redrawReason=s;const t=c.getViewports();e.lastRenderedViewports!==t?e.forceUpdate():j(e)}});return c}function N(e,n){const[r,c]=o.useState(0),t=o.useRef({control:null,version:r,forceUpdate:()=>c(u=>u+1)}).current,i=o.useRef(null),a=o.useRef(null),d=o.useMemo(()=>q(e),[e.layers,e.views,e.children]);let f=!0;const l=u=>f&&e.viewState?(t.viewStateUpdateRequested=u,null):(t.viewStateUpdateRequested=null,e.onViewStateChange?.(u)),p=u=>{f?t.interactionStateUpdateRequested=u:(t.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(u))},k=o.useMemo(()=>{const u={widgets:[],...e,style:null,width:"100%",height:"100%",parent:i.current,canvas:a.current,layers:d.layers,views:d.views,onViewStateChange:l,onInteractionStateChange:p};return delete u._customRender,t.deck&&t.deck.setProps(u),u},[e]);o.useEffect(()=>{const u=e.Deck||D;return t.deck=H(t,u,{...k,parent:i.current,canvas:a.current}),()=>t.deck?.finalize()},[]),M(()=>{j(t);const{viewStateUpdateRequested:u,interactionStateUpdateRequested:C}=t;u&&l(u),C&&p(C),t.deck?.isInitialized&&t.deck.redraw("Initial render")}),o.useImperativeHandle(n,()=>F(t),[]);const w=t.deck&&t.deck.isInitialized?t.deck.getViewports():void 0,{ContextProvider:y,width:h="100%",height:S="100%",id:V,style:v}=e,{containerStyle:L,canvasStyle:I}=o.useMemo(()=>$({width:h,height:S,style:v}),[h,S,v]);if(!t.viewStateUpdateRequested&&t.lastRenderedViewports===w||t.version!==r){t.lastRenderedViewports=w,t.version=r;const u=G({children:d.children,deck:t.deck,ContextProvider:y}),C=o.createElement("canvas",{key:"canvas",id:V||"deckgl-overlay",ref:a,style:I});t.control=o.createElement("div",{id:`${V||"deckgl"}-wrapper`,ref:i,style:L},[C,u])}return f=!1,t.control}const K=o.forwardRef(N);export{K as D,o as r};
//# sourceMappingURL=deckgl_react-Azql1Hzl.js.map
